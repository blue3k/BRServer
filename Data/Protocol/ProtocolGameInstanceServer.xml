<?xml version="1.0" encoding="UTF-8"?>
<Protocols xmlns="http://www.StormForge.com/XMLProtocol" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.StormForge.com/XMLProtocol ../../../StormForge/Engine/Data/Protocol/ProtocolDef.xsd">
	<ProtocolGroup Name="GameInstance" GenParameterRouteContext="true" IsMobile="false" IsServer="true" Desc="Game instance service Protocol">

	<!-- ============================  Server Generic  ============================================ -->


		<Command Name="JoinGameInstance" Reliable="true" Crypto="No" Trace="Debug1" Desc="Join to a game instance. You can call multiple times, but it would be a waste">
			<Cmd>
				<Params Type="PlayerInformation" Name="Player" Desc="Player information who join"/>
			</Cmd>
			<Res>
				<Params Type="NetAddress" Name="GameInsSvr4" Desc="Game instance server address. Client will use this address to connect game server."/>
				<Params Type="NetAddress" Name="GameInsSvr6" Desc="Game instance server address. Client will use this address to connect game server."/>
				<Params Type="uint32" Name="TimeStamp" Desc="Time stamp of game state"/>
			</Res>
		</Command>

		<!--<S2CEvent Name="PlayerJoined" Reliable="true" Crypto="No" Trace="Debug1" Desc="Player joined event. This event is brocasted when a player joined">
			<Params Type="PlayerInformation" Name="JoinedPlayer" Desc="Joined player information"/>
		</S2CEvent>-->

		<Command Name="LeaveGameInstance" Reliable="true" Crypto="No" Trace="Debug1" Desc="Leave game instance.">
			<Cmd>
				<Params Type="PlayerID" Name="PlayerID" Desc="PlayID to leave"/>
			</Cmd>
			<Res>
			</Res>
		</Command>

		<!--<S2CEvent Name="PlayerLeft" Reliable="true" Crypto="No" Trace="Debug1" Desc="Player left event.">
			<Params Type="PlayerID" Name="LeftPlayerID" Desc="Player ID who left."/>
		</S2CEvent>-->


		<C2SEvent Name="PlayerMovement" Reliable="true" Crypto="No" Trace="Debug1" Desc="Player Movement">
			<Params Type="GameInsUID" Name="GameInsUID" Desc="Game instance UID"/>
			<Params Type="PlayerID" Name="PlayerID" Desc="Player Id"/>
			<Params Type="VariableTable" Name="Attributes" Desc="Movement attributes"/>
		</C2SEvent>

		<S2CEvent Name="PlayerMovement" Reliable="true" Crypto="No" Trace="Debug1" Desc="Player Movement">
			<Params Type="GameInsUID" Name="GameInsUID" Desc="Game instance UID"/>
			<Params Type="PlayerID" Name="PlayerID" Desc="Player Movement"/>
			<Params Type="VariableTable" Name="Attributes" Desc="Movement attributes"/>
		</S2CEvent>



		<!-- =============================  Legacy messages  ======================================= -->


		<Command Name="KickPlayer" Reliable="true" Crypto="No" Trace="Debug1" Desc="Kick player with given ID">
			<Cmd>
				<Params Type="PlayerID" Name="PlayerID" Desc="Player who kick."/>
				<Params Type="PlayerID" Name="PlayerToKick" Desc="Player who kicked."/>
			</Cmd>
			<Res>
			</Res>
		</Command>

		<Command Name="JoinGame" Reliable="true" Crypto="No" Trace="Debug1" Desc="Join to a game instance. You can call multiple times, but it would be waste">
			<Cmd>
				<Params Type="PlayerInformation" Name="Player" Desc="Player information who join"/>
				<Params Type="PlayerRole" Name="RequestedRole" Desc="Requested player role[For specific game. otherwise ignore it]"/>
			</Cmd>
			<Res>
				<Params Type="NetAddress" Name="GameInsSvr" Desc="Game instance server address. Client will use this address to connect game server."/>
				<Params Type="uint32" Name="TimeStamp" Desc="Time stamp of game state"/>
				<Params Type="GameStateID" Name="GameState" Desc="GameState ID"/>
				<Params Type="uint8" Name="Day" Desc="Game State information"/>
				<Params Type="uint8" Name="MaxPlayer" Desc="Maximum player count"/>
				<Params Type="uint8" Name="PlayerIndex" Desc="Player index in the game instance."/>
				<Params Type="uint8" Name="PlayerCharacter" Desc="Player character."/>
				<Params Type="PlayerRole" Name="Role" Desc="Player role assigned by game instance."/>
				<Params Type="uint8" Name="Dead" Desc="Player statues."/>
				<Params Type="uint8" Name="IsNewJoin" Desc="true if the player joined at the first time."/>
				<Params Type="uint8" Name="ChatHistoryData" IsArray="true" Desc="[optional]."/>
				<Params Type="uint8" Name="GameLogData" IsArray="true" Desc="[Optional] you can send game status through this parameter."/>
			</Res>
		</Command>


		<Command Name="AssignRole" Reliable="true" Crypto="No" Trace="Debug1" Desc="Assign new roles to all players.">
			<Cmd>
				<Params Type="PlayerID" Name="PlayerID" Desc="[Optional] requester playerID"/>
			</Cmd>
			<Res>
			</Res>
		</Command>

		<S2CEvent Name="RoleAssigned" Reliable="true" Crypto="No" Trace="Debug1" Desc="Event for role assigned">
			<Params Type="PlayerRole" Name="Role" Desc="Assigned new role."/>
		</S2CEvent>


		<C2SEvent Name="ChatMessage" Reliable="true" Crypto="No" Trace="Debug1" Desc="in-game chatting message.">
			<Params Type="PlayerID" Name="PlayerID" Desc="Sender playerID"/>
			<Params Type="PlayerRole" Name="Role" Desc="player Role for recipent role filtering"/>
			<Params Type="String" Name="ChatMessage" Desc="Chatting message"/>
		</C2SEvent>

		<Command Name="AdvanceGame" Reliable="true" Crypto="No" Trace="Debug1" Desc="Advance game">
			<Cmd>
				<Params Type="PlayerID" Name="PlayerID" Desc="Advance game state"/>
			</Cmd>
			<Res>
			</Res>
		</Command>

		<S2CEvent Name="GameAdvanced" Reliable="true" Crypto="No" Trace="Debug1" Desc="The game state is advanced">
			<Params Type="uint32" Name="TimeStamp"/>
			<Params Type="GameStateID" Name="GameState"/>
			<Params Type="uint8" Name="Day"/>
		</S2CEvent>

		<S2CEvent Name="GameEnded" Reliable="true" Crypto="No" Trace="Debug1" Desc="Game is ended">
			<Params Type="GameWinner" Name="Winner"/>
			<Params Type="uint32" Name="GainedExp"/>
			<Params Type="uint32" Name="GainedGameMoney"/>
			<Params Type="PlayerRole" Name="PlayedRole"/>
			<Params Type="uint8" Name="IsWon"/>
		</S2CEvent>

		<Command Name="VoteGameAdvance" Reliable="true" Crypto="No" Trace="Debug1" Desc="*Vote game advance">
			<Cmd>
				<Params Type="PlayerID" Name="PlayerID"/>
			</Cmd>
			<Res>
			</Res>
		</Command>

		<S2CEvent Name="GameAdvanceVoted" Reliable="true" Crypto="No" Trace="Debug1" Desc="*GameAdvance is Voted">
			<Params Type="PlayerID" Name="Voter"/>
		</S2CEvent>

		<Command Name="Vote" Reliable="true" Crypto="No" Trace="Debug1" Desc="Assign role">
			<Cmd>
				<Params Type="PlayerID" Name="PlayerID"/>
				<Params Type="PlayerID" Name="VoteTarget"/>
				<Params Type="uint32" Name="ActionSerial"/>
			</Cmd>
			<Res>
			</Res>
		</Command>

		<S2CEvent Name="Voted" Reliable="true" Crypto="No" Trace="Debug1" Desc="Player Voted">
			<Params Type="PlayerID" Name="Voter"/>
			<Params Type="PlayerID" Name="VotedTarget"/>
		</S2CEvent>

		<S2CEvent Name="VoteEnd" Reliable="true" Crypto="No" Trace="Debug1" Desc="Player Voted">
			<Params Type="PlayerID" IsArray="true" Name="Voted"/>
		</S2CEvent>

		<S2CEvent Name="PlayerRevealed" Reliable="true" Crypto="No" Trace="Debug1" Desc="Player Voted">
			<Params Type="PlayerID" Name="RevealedPlayerID"/>
			<Params Type="PlayerRole" Name="Role"/>
			<Params Type="PlayerRevealedReason" Name="Reason"/>
		</S2CEvent>

		<S2CEvent Name="PlayerKilled" Reliable="true" Crypto="No" Trace="Debug1" Desc="Player Killed">
			<Params Type="PlayerID" Name="KilledPlayer"/>
			<Params Type="PlayerKilledReason" Name="Reason"/>
		</S2CEvent>

		<Command Name="GamePlayAgain" Reliable="true" Crypto="No" Trace="Debug1" Desc="Play again with the current players">
			<Cmd>
				<Params Type="PlayerID" Name="LeadPlayer" Desc="Player who pressed replay"/>
				<Params Type="PartyUID" Name="PartyUID" Desc="Party ID"/>
			</Cmd>
			<Res>
				<Params Type="uint32" Name="ReplayMemberCount" Desc="Member count"/>
			</Res>
		</Command>

		<S2CEvent Name="GamePlayAgain" Reliable="true" Crypto="No" Trace="Debug1" Desc="Somebody pressed play again. Only one of PartyUID and GameInsUID can have a value">
			<Params Type="PlayerID" Name="TargetPlayer" Desc="Event target player"/>
			<Params Type="PartyUID" Name="PartyUID" Desc="Party ID"/>
			<Params Type="PlayerID" Name="LeadPlayer" Desc="Player who called play again"/>
		</S2CEvent>

		<Command Name="GameRevealPlayer" Reliable="true" Crypto="No" Trace="Debug1" Desc="Player. revive himself">
			<Cmd>
				<Params Type="PlayerID" Name="PlayerID"/>
				<Params Type="PlayerID" Name="TargetPlayerID" IsArray="true"/>
			</Cmd>
			<Res>
				<Params Type="PlayerID" Name="RevealedPlayerID" IsArray="true"/>
				<Params Type="PlayerRole" Name="RevealedRole" IsArray="true"/>
			</Res>
		</Command>

		<Command Name="GamePlayerRevive" Reliable="true" Crypto="No" Trace="Debug1" Desc="Player. revive himself">
			<Cmd>
				<Params Type="PlayerID" Name="PlayerID"/>
			</Cmd>
			<Res>
			</Res>
		</Command>

		<S2CEvent Name="GamePlayerRevived" Reliable="true" Crypto="No" Trace="Debug1" Desc="Player is revived">
			<Params Type="PlayerID" Name="RevivedPlayerID" Desc="Player who is revived"/>
		</S2CEvent>


		<!-- =============================  ======================================= -->

	</ProtocolGroup>
</Protocols>
